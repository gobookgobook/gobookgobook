<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.bookmanageMapper">
	<insert id="bookInsert" parameterType="com.gobook.bookmanage.dto.BookDto">
		insert into book values(#{book_num},#{book_name},#{book_writer},#{book_publisher},#{book_publish_date},#{book_cost},#{book_price},#{book_quantity, jdbcType=INTEGER},#{book_index, jdbcType=VARCHAR},#{book_summary, jdbcType=VARCHAR},#{book_category},#{book_cover_file_name, jdbcType=VARCHAR},#{book_cover_file_path, jdbcType=VARCHAR},#{book_cover_file_size, jdbcType=INTEGER},#{book_preview_file_name1, jdbcType=VARCHAR},#{book_preview_file_path1, jdbcType=VARCHAR},#{book_preview_file_size1, jdbcType=INTEGER},#{book_preview_file_name2, jdbcType=VARCHAR},#{book_preview_file_path2, jdbcType=VARCHAR},#{book_preview_file_size2, jdbcType=INTEGER},#{book_preview_file_name3, jdbcType=VARCHAR},#{book_preview_file_path3, jdbcType=VARCHAR},#{book_preview_file_size3, jdbcType=INTEGER},#{book_star, jdbcType=FLOAT},#{book_reorder_count, jdbcType=INTEGER},#{book_group_purchase_count, jdbcType=INTEGER},#{book_state})
	</insert>
	
	<select id="bookStockCount" resultType="int">
		select count(*) from book 
	</select>
	
	<select id="bookList" parameterType="java.util.Map" resultType="com.gobook.bookmanage.dto.BookDto">
		<![CDATA[
			select * from
				(select rownum rnum, a.* from
					(select * from book order by book_quantity asc, book_reorder_count desc)a )
			where rnum>=#{startRow} and rnum<=#{endRow}
		]]>
	</select>
	
	<select id="bookInfo" parameterType="long" resultType="com.gobook.bookmanage.dto.BookDto">
		select * from book where book_num=#{book_num}
	</select>
	
	<insert id="bookReOrderInsert" parameterType="java.util.Map">
		insert into BOOKREORDER values(BOOKREORDER_REORDER_NUM_seq.nextval,#{book_num},#{book_name},#{reorder_quantity},sysdate,#{reorder_price})
	</insert>
	
	<insert id="salesMonthListInsert" parameterType="java.util.Map">
		insert into SALESMONTHLY(SALESM_NUM,BOOK_NUM,SALESMONTHLY_DATE,SALESMONTHLY_ORDER_BOOKNAME,SALESMONTHLY_ORDER_QUANTITY,SALESMONTHLY_ORDER_COST,SALESMONTHLY_ORDER_TOTALPRICE) 
		values(SALESMONTHLY_SALESM_NUM_seq.nextval,#{book_num},sysdate,#{book_name},#{reorder_quantity},#{book_cost},#{reorder_price})
	</insert>
	
	<update id="bookStockUpdate" parameterType="com.gobook.bookmanage.dto.BookDto">
		update book set book_name=#{book_name},book_writer=#{book_writer},book_publisher=#{book_publisher},book_publish_date=#{book_publish_date},book_cost=#{book_cost},book_price=#{book_price},book_quantity=#{book_quantity},book_index=#{book_index, jdbcType=VARCHAR},book_summary=#{book_summary, jdbcType=VARCHAR},book_category=#{book_category},book_cover_file_name=#{book_cover_file_name, jdbcType=VARCHAR},book_cover_file_path=#{book_cover_file_path, jdbcType=VARCHAR},book_cover_file_size=#{book_cover_file_size, jdbcType=INTEGER},book_preview_file_name1=#{book_preview_file_name1, jdbcType=VARCHAR},book_preview_file_path1=#{book_preview_file_path1, jdbcType=VARCHAR},book_preview_file_size1=#{book_preview_file_size1, jdbcType=INTEGER},book_preview_file_name2=#{book_preview_file_name2, jdbcType=VARCHAR},book_preview_file_path2=#{book_preview_file_path2, jdbcType=VARCHAR},book_preview_file_size2=#{book_preview_file_size2, jdbcType=INTEGER},book_preview_file_name3=#{book_preview_file_name3, jdbcType=VARCHAR},book_preview_file_path3=#{book_preview_file_path3, jdbcType=VARCHAR},book_preview_file_size3=#{book_preview_file_size3, jdbcType=INTEGER},book_state=#{book_state} where book_num=#{book_num}
	</update>
	
	<select id="bookReOrderListCount" resultType="int">
		select count(*) from BOOKREORDER
	</select>
	
	<select id="bookReOrderList" parameterType="java.util.Map" resultType="com.gobook.bookmanage.dto.BookReOrderDto">
		<![CDATA[
			select * from
				(select rownum rnum, a.* from
					(select * from BOOKREORDER order by REORDER_NUM desc)a )
			where rnum>=#{startRow} and rnum<=#{endRow}
		]]>
	</select>
	
	<select id="bookReOrderCount" resultType="int">
		select count(*) from book where BOOK_REORDER_COUNT!=0
	</select>
	
	<select id="bookReOrderCountList" parameterType="java.util.Map" resultType="com.gobook.bookmanage.dto.BookDto">
		<![CDATA[
			select * from
				(select rownum rnum, a.* from
					(select * from book order by BOOK_REORDER_COUNT desc)a )
			where rnum>=#{startRow} and rnum<=#{endRow} and BOOK_REORDER_COUNT!=0
		]]>
	</select>
	
	<select id="bookGroupPurchaseCount" resultType="int">
		select count(*) from book where BOOK_GROUP_PURCHASE_COUNT!=0
	</select>
	
	<select id="bookGroupPurchaseCountList" parameterType="java.util.Map" resultType="com.gobook.bookmanage.dto.BookDto">
		<![CDATA[
			select * from
				(select rownum rnum, a.* from
					(select * from book order by BOOK_GROUP_PURCHASE_COUNT desc)a )
			where rnum>=#{startRow} and rnum<=#{endRow} and BOOK_GROUP_PURCHASE_COUNT!=0
		]]>
	</select>
	
	<select id="bookSoldOutCount" resultType="int">
		select count(*) from book where book_quantity=0
	</select>
	
	<select id="bookSoldOutList" parameterType="java.util.Map" resultType="com.gobook.bookmanage.dto.BookDto">
		<![CDATA[
			select * from
				(select rownum rnum, a.* from
					(select * from book order by BOOK_REORDER_COUNT desc, BOOK_GROUP_PURCHASE_COUNT desc)a )
			where rnum>=#{startRow} and rnum<=#{endRow} and book_quantity=0
		]]>
	</select>
	
</mapper>